<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Student Setup | Digital Literacy Games</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Georgia,serif;background:linear-gradient(135deg,#1e3a5f,#2d5a87);min-height:100vh;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:20px}
.container{background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.3);border-radius:20px;padding:30px;width:100%;max-width:400px;text-align:center}
.logo{font-size:3em;margin-bottom:10px}
h1{font-size:1.5em;margin-bottom:5px}
.subtitle{opacity:0.8;margin-bottom:25px}
.form-group{margin-bottom:20px;text-align:left}
.form-group label{display:block;margin-bottom:8px;font-size:0.9em;opacity:0.9}
.form-group input{width:100%;padding:15px;font-size:1.1em;border:3px solid rgba(255,255,255,0.3);border-radius:12px;background:rgba(255,255,255,0.1);color:#fff;text-align:center}
.form-group input:focus{outline:none;border-color:#ffd700}
.form-group input::placeholder{color:rgba(255,255,255,0.5)}
.btn{width:100%;padding:15px;font-size:1.1em;font-weight:bold;border:none;border-radius:25px;cursor:pointer;margin-top:10px;transition:transform 0.2s}
.btn:active{transform:scale(0.98)}
.btn-primary{background:linear-gradient(135deg,#2ecc71,#27ae60);color:#fff}
.btn-secondary{background:rgba(255,255,255,0.1);border:2px solid rgba(255,255,255,0.3);color:#fff;margin-top:15px}
.info{background:rgba(255,215,0,0.2);padding:15px;border-radius:12px;margin-bottom:20px;font-size:0.9em;line-height:1.5}
.info b{color:#ffd700}
.current-info{background:rgba(46,204,113,0.2);padding:15px;border-radius:12px;margin-bottom:20px}
.current-info h3{color:#2ecc71;margin-bottom:10px}
.current-info p{font-size:0.9em;margin-bottom:5px}
.hidden{display:none}
.stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:15px}
.stat{background:rgba(0,0,0,0.2);padding:10px;border-radius:8px;text-align:center}
.stat b{display:block;color:#ffd700;font-size:1.3em}
.stat span{font-size:0.75em;opacity:0.8}
</style>
</head>
<body>

<div class="container">
<div class="logo">üéì</div>
<h1>Student Setup</h1>
<p class="subtitle">Configuraci√≥n del Estudiante</p>

<div id="currentInfo" class="current-info hidden">
<h3>‚úì You're all set!</h3>
<p><strong>Name:</strong> <span id="displayName"></span></p>
<p><strong>Class Code:</strong> <span id="displayCode"></span></p>
<div class="stats">
<div class="stat"><b id="displayGames">0</b><span>Games Played</span></div>
<div class="stat"><b id="displayAvg">0%</b><span>Avg Score</span></div>
</div>
</div>

<div id="setupForm">
<div class="info">
<b>üí° Why set up?</b><br>
Your scores will be saved and your teacher can track your progress!
</div>

<div class="form-group">
<label>üë§ Your Name / Tu Nombre</label>
<input type="text" id="studentName" placeholder="Enter your name...">
</div>

<div class="form-group">
<label>üîë Class Code (from your teacher) / C√≥digo de Clase</label>
<input type="text" id="classCode" placeholder="ABC123" maxlength="10" style="text-transform:uppercase;letter-spacing:3px">
</div>

<button class="btn btn-primary" onclick="saveSetup()">‚úì Save & Continue</button>
</div>

<button class="btn btn-secondary" onclick="goToGames()">üéÆ Go to Games</button>

<div id="resetSection" class="hidden" style="margin-top:20px">
<button class="btn btn-secondary" onclick="resetSetup()" style="background:rgba(231,76,60,0.2);border-color:#e74c3c">üîÑ Reset My Info</button>
</div>
</div>

<script>
// Check for Firebase config from teacher
var hasFirebase = !!localStorage.getItem('firebase_config');

function loadExisting() {
    var name = localStorage.getItem('dl_student_name');
    var code = localStorage.getItem('dl_class_code');
    var stats = JSON.parse(localStorage.getItem('dl_student_stats') || '{}');
    
    if (name) {
        document.getElementById('displayName').textContent = name;
        document.getElementById('displayCode').textContent = code || 'None';
        document.getElementById('displayGames').textContent = stats.gamesPlayed || 0;
        document.getElementById('displayAvg').textContent = (stats.avgScore || 0) + '%';
        
        document.getElementById('currentInfo').classList.remove('hidden');
        document.getElementById('setupForm').classList.add('hidden');
        document.getElementById('resetSection').classList.remove('hidden');
        
        // Pre-fill form
        document.getElementById('studentName').value = name;
        document.getElementById('classCode').value = code || '';
    }
    
    // Show sync status
    if (hasFirebase && code) {
        document.getElementById('displayCode').innerHTML = code + ' <span style="color:#2ecc71">‚òÅÔ∏è Syncing</span>';
    }
}

function saveSetup() {
    var name = document.getElementById('studentName').value.trim();
    var code = document.getElementById('classCode').value.trim().toUpperCase();
    
    if (!name) {
        alert('Please enter your name');
        return;
    }
    
    localStorage.setItem('dl_student_name', name);
    if (code) {
        localStorage.setItem('dl_class_code', code);
    }
    
    // Generate student ID if not exists
    if (!localStorage.getItem('dl_student_id')) {
        var id = 's_' + Date.now() + '_' + Math.random().toString(36).substr(2,6);
        localStorage.setItem('dl_student_id', id);
    }
    
    var msg = 'Saved! Your scores will now be tracked.\n\nName: ' + name;
    if (code) msg += '\nClass: ' + code;
    if (hasFirebase) msg += '\n\n‚òÅÔ∏è Cloud sync enabled - your teacher will see your scores!';
    
    alert(msg);
    loadExisting();
}

function resetSetup() {
    if (confirm('This will reset your name and class code. Your game scores will be kept. Continue?')) {
        localStorage.removeItem('dl_student_name');
        localStorage.removeItem('dl_class_code');
        
        document.getElementById('currentInfo').classList.add('hidden');
        document.getElementById('setupForm').classList.remove('hidden');
        document.getElementById('resetSection').classList.add('hidden');
        document.getElementById('studentName').value = '';
        document.getElementById('classCode').value = '';
    }
}

function goToGames() {
    window.location.href = 'digital-literacy-homepage.html';
}

// Initialize
loadExisting();

// Auto-uppercase class code
document.getElementById('classCode').addEventListener('input', function(e) {
    e.target.value = e.target.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
});
</script>

</body>
</html>
